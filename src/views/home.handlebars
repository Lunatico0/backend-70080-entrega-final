<h1 class="my-8 text-white text-4xl font-bold">Productos</h1>

<form id="limitForm" action="?" class="mb-4">
  <label for="cant" class="text-white">Cantidad de productos mostrados</label>
  <select name="limit" id="cant" class="bg-slate-300 border border-slate-400 rounded px-2 py-1">
    <option value="5" {{#ifCond limit '==' 5}}selected{{/ifCond}}>5</option>
    <option value="10" {{#ifCond limit '==' 10}}selected{{/ifCond}}>10</option>
    <option value="15" {{#ifCond limit '==' 15}}selected{{/ifCond}}>15</option>
    <option value="30" {{#ifCond limit '==' 30}}selected{{/ifCond}}>30</option>
    <option value="50" {{#ifCond limit '==' 50}}selected{{/ifCond}}>50</option>
    <option value="75" {{#ifCond limit '==' 75}}selected{{/ifCond}}>75</option>
    <option value="100" {{#ifCond limit '==' 100}}selected{{/ifCond}}>100</option>
    <option value="200" {{#ifCond limit '==' 200}}selected{{/ifCond}}>200</option>
  </select>
</form>

<div class="flex justify-center w-3/4 items-center gap-2 flex-wrap">
  {{#each products}}
  <div class="flex flex-col justify-between bg-slate-600 rounded w-60 min-h-32 h-[400px] p-1">
    <div class="flex flex-col object-fill">
      <img src="{{modifyImageUrl this.thumbnails.[0] '240' '240'}}" class="w-full h-auto rounded-sm object-cover">
    </div>
    <div class="text-white flex flex-col gap-2">
      <h2 class="text-xl text-white leading-6 itemDescripcion"> {{this.title}} </h2>
      <h3 class="text-sm text-white leading-4">
        {{#each description}}
        {{#ifCond this.label '==' "MEDIDAS"}}
        {{this.label}}: {{this.value}}
        {{/ifCond}}
        {{/each}}
      </h3>
      <p class="text-white"> ${{formatNumber price 2}} </p>
    </div>
    <button
      class="bg-slate-400/90 border-slate-400 border hover:bg-slate-500 active:bg-slate-300 active:text-black mt-2 rounded text-white"
      id="{{this.id}}">Agregar</button>
  </div>
  {{/each}}
</div>

<div class="flex flex-row gap-4 pt-4 botones pagination">
  <a id="prevPageLink" class="
    {{#if hasPrevPage}}
    bg-slate-400/90 
    border-slate-400 border 
    hover:bg-slate-500 
    active:bg-slate-300
    active:text-black 
    text-white
    mt-2 px-2 py-1 
    rounded
    {{else}}
    buttons
    bg-slate-400/90 
    border-slate-400 border 
    hover:bg-slate-500 
    active:bg-slate-300
    active:text-black 
    text-white
    mt-2 px-2 py-1 
    rounded
    cursor-not-allowed
    opacity-50
    {{/if}}" href="{{#if hasPrevPage}}/products?page={{prevPage}}&limit={{limit}}{{else}}#{{/if}}">
    ◀️
  </a>

  {{#if (gte currentPage (add 1 3)) }}
    <a id="prevPageLink" class="bg-slate-400/90 
      border-slate-400 border 
      hover:bg-slate-500 
      active:bg-slate-300
      active:text-black 
      text-white
        mt-2 px-2 py-1 
        rounded" 
      href="/products?page={{1}}&limit={{limit}}">
      1
    </a>
    {{#if (gt currentPage 4)}}
      <p class="text-white px-2 pt-4">...</p>
    {{/if}}
  {{/if}}

  {{#each totalPages}}
  <a href="/products?page={{this}}&limit={{../limit}}{{#if ../sort}}&sort={{../sort}}{{/if}}" class=" bg-slate-400/90 
            border-slate-400 border 
            hover:bg-slate-500 
            active:bg-slate-300
            active:text-black 
            text-white
              mt-2 px-2 py-1 
              rounded
    {{#if (eq this ../currentPage)}}active{{/if}}">{{this}}</a>
  {{/each}}

  {{#if (and (gte lastPage 6) (lte currentPage (subtract lastPage 3)))}}
    {{#if (lt currentPage (subtract lastPage 3))}}
      <p class="text-white px-2 pt-4">...</p>
    {{/if}}
    <a id="nextPageLink" class="bg-slate-400/90 
      border-slate-400 border 
      hover:bg-slate-500 
      active:bg-slate-300
      active:text-black 
      text-white
        mt-2 px-2 py-1 
        rounded" 
      href="/products?page={{lastPage}}&limit={{limit}}">
      {{lastPage}}
    </a>
  {{/if}}

  <a id="nextPageLink" class="
    {{#if hasNextPage}}
    bg-slate-400/90
    border-slate-400 border 
    hover:bg-slate-500 
    active:bg-slate-300
    active:text-black 
    text-white
    mt-2 px-2 py-1 
    rounded
    {{else}}
    buttons
    bg-slate-400/90 
    border-slate-400 border 
    hover:bg-slate-500 
    active:bg-slate-300
    active:text-black 
    text-white
    mt-2 px-2 py-1 
    rounded
    cursor-not-allowed
    opacity-50
    {{/if}}" href="{{#if hasNextPage}}/products?page={{nextPage}}&limit={{limit}}{{else}}#{{/if}}">
    ▶️
  </a>
</div>

<script>
  document.getElementById('cant').addEventListener('change', function () {
    document.getElementById('limitForm').submit();
  });

  document.getElementById('prevPageLink').addEventListener('click', function (event) {
    if (this.classList.contains('cursor-not-allowed')) {
      event.preventDefault();
    }
  });

  document.getElementById('nextPageLink').addEventListener('click', function (event) {
    if (this.classList.contains('cursor-not-allowed')) {
      event.preventDefault();
    }
  });
</script>

<style>
  .itemDescripcion {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
  }

  .buttons {
    pointer-events: none;
    cursor: not-allowed;
  }

  .pagination a.active {
    background-color: #cbd5e1;
    color: black;
    border: 1px solid #94a3b8;
  }
</style>